# 05_sitemap.md - のびレコ サイトマップ要件定義

## 1. サイトマップ構造図

```
のびレコ
│
├── 🔐 認証
│   └── /login - ログイン画面
│
├── 👔 サイト管理者エリア (/admin)
│   ├── /admin - サイト管理者TOP
│   │
│   ├── 会社管理
│   │   ├── /admin/companies - 会社一覧
│   │   ├── /admin/companies/new - 会社登録
│   │   └── /admin/companies/:id/edit - 会社編集
│   │
│   ├── 施設管理（全体）
│   │   ├── /admin/facilities - 施設一覧（全体管理）
│   │   ├── /admin/facilities/new - 施設登録
│   │   └── /admin/facilities/:id/edit - 施設編集
│   │
│   ├── ユーザー管理（全体）
│   │   └── /admin/users - ユーザー一覧（全体管理）
│   │
│   └── システムログ
│       └── /admin/logs - ログイン履歴・システムログ
│
└── 🏫 施設管理者/職員エリア
    ├── /dashboard - 施設管理者/職員TOP（ダッシュボード）
    │
    ├── 📝 記録管理 (/records)
    │   ├── /records/status - 記録状況一覧（本日の入力状況）
    │   ├── /records/activity - 活動記録入力（今日の全体活動）
    │   ├── /records/observation/:childId - 子ども観察記録（個別の様子）
    │   └── /records/voice/:childId - 子どもの声記録
    │
    ├── 📋 出席管理 (/attendance)
    │   ├── /attendance/schedule - 本日の出席予定登録（曜日ベース+イレギュラー調整）
    │   ├── /attendance/qr - QR出欠画面（子どもがスキャン）
    │   └── /attendance/list - 出席児童一覧（今日来ている子）
    │
    ├── 👶 子ども管理 (/children)
    │   ├── /children - 子ども一覧（検索・フィルター）
    │   ├── /children/:id - 子ども詳細（基礎情報・観点別記録）
    │   ├── /children/:id/summary - 成長サマリ（観点別集計グラフ）
    │   ├── /children/:id/report - レポート生成
    │   ├── /children/new - 子ども情報登録
    │   ├── /children/:id/edit - 子ども情報編集
    │   └── /children/import - CSV一括登録
    │
    ├── ⚙️ 設定 (/settings)
    │   ├── /settings/facility - 施設情報管理
    │   ├── /settings/classes - クラス登録・管理
    │   ├── /settings/schedules - 子ども別曜日通所設定（何曜日に来るか登録）
    │   └── /settings/users - 職員アカウント管理・権限設定
    │
    └── 💾 データ管理 (/data)
        └── /data/export - データエクスポート・バックアップ
```

---

## 2. 権限別アクセス制御

### 2.1 サイト管理者

- **アクセス可能範囲**: `/admin/*` 配下のすべてのページ
- **主な権限**:
    - 会社の登録・編集・削除
    - 施設の登録・編集・削除（全社横断）
    - ユーザーの閲覧（全社横断）
    - システムログの閲覧

### 2.2 施設管理者

- **アクセス可能範囲**: `/dashboard`, `/records/*`, `/attendance/*`, `/children/*`, `/settings/*`, `/data/*`
- **主な権限**:
    - 自施設の記録管理（全権限）
    - 自施設の出席管理（全権限）
    - 自施設の子ども情報管理（全権限）
    - 自施設の設定管理（全権限）
    - 職員アカウント管理（自施設のみ）

### 2.3 一般職員

- **アクセス可能範囲**: `/dashboard`, `/records/*`, `/attendance/*`, `/children/*`
- **主な権限**:
    - 記録の作成・編集
    - 出席管理の閲覧・操作
    - 子ども情報の閲覧
    - レポート生成
- **制限事項**:
    - 設定変更不可（`/settings/*`へのアクセス不可）
    - データエクスポート不可

---

## 3. ページ一覧と機能概要

### 3.1 認証系

|パス|ページ名|主な機能|対象ユーザー|
|---|---|---|---|
|`/login`|ログイン画面|メールアドレス・パスワード認証|全ユーザー|

---

### 3.2 サイト管理者エリア

|パス|ページ名|主な機能|備考|
|---|---|---|---|
|`/admin`|サイト管理者TOP|全体ダッシュボード、統計情報表示|サイト管理者専用|
|`/admin/companies`|会社一覧|登録会社の一覧表示、検索|-|
|`/admin/companies/new`|会社登録|新規会社情報の登録|-|
|`/admin/companies/:id/edit`|会社編集|会社情報の編集・削除|-|
|`/admin/facilities`|施設一覧（全体管理）|全施設の一覧表示、検索、会社フィルター|-|
|`/admin/facilities/new`|施設登録|新規施設情報の登録|会社との紐づけ必須|
|`/admin/facilities/:id/edit`|施設編集|施設情報の編集・削除|-|
|`/admin/users`|ユーザー一覧（全体管理）|全ユーザーの一覧表示、検索、フィルター|閲覧のみ|
|`/admin/logs`|ログイン履歴・システムログ|ログイン履歴、操作ログの表示、検索|-|

---

### 3.3 施設管理者/職員エリア - ダッシュボード

|パス|ページ名|主な機能|備考|
|---|---|---|---|
|`/dashboard`|ダッシュボード|本日の概要、未記録アラート、未帰所通知、クイックアクション|施設管理者/職員専用|

---

### 3.4 記録管理 (/records)

|パス|ページ名|主な機能|備考|
|---|---|---|---|
|`/records/status`|記録状況一覧|本日の記録入力状況、未記録児童の確認|-|
|`/records/activity`|活動記録入力|今日の全体活動の記録、写真アップロード、音声入力、テンプレート機能、リアルタイム編集|**メイン業務導線**|
|`/records/observation/:childId`|子ども観察記録|個別の子どもの様子記録、タグ付け、活動記録との同時編集|活動記録から展開|
|`/records/voice/:childId`|子どもの声記録|子ども本人の声・意見の直接入力|-|

---

### 3.5 出席管理 (/attendance)

|パス|ページ名|主な機能|備考|
|---|---|---|---|
|`/attendance/schedule`|本日の出席予定登録|曜日ベースの自動表示、欠席登録、イレギュラー出席登録|朝の業務|
|`/attendance/qr`|QR出欠画面|QRコード表示、子どもによる自動チェックイン|タブレット等で常時表示|
|`/attendance/list`|出席児童一覧|本日出席中の子ども一覧、未帰所アラート表示|-|

---

### 3.6 子ども管理 (/children)

|パス|ページ名|主な機能|備考|
|---|---|---|---|
|`/children`|子ども一覧|全子どもの一覧、検索（名前・タグ）、フィルター（学年・性別・タグ）、ソート（記録数）|-|
|`/children/:id`|子ども詳細|基礎情報表示、観点別記録一覧、最近の記録|**個別情報のハブ**|
|`/children/:id/summary`|成長サマリ|観点別の記録数推移グラフ、3ヶ月程度の変化の可視化|-|
|`/children/:id/report`|レポート生成|保護者向けレポートの自動生成、共有履歴記録|-|
|`/children/new`|子ども情報登録|新規子ども情報の手動登録|施設管理者のみ|
|`/children/:id/edit`|子ども情報編集|子ども基礎情報の編集|施設管理者のみ|
|`/children/import`|CSV一括登録|CSVファイルによる子ども情報の一括登録|施設管理者のみ|

---

### 3.7 設定 (/settings)

|パス|ページ名|主な機能|備考|
|---|---|---|---|
|`/settings/facility`|施設情報管理|施設名、住所、連絡先等の基本情報編集|施設管理者のみ|
|`/settings/classes`|クラス登録・管理|クラスの作成・編集・削除|施設管理者のみ|
|`/settings/schedules`|子ども別曜日通所設定|各子どもの通所曜日パターンの登録・編集|施設管理者のみ|
|`/settings/users`|職員アカウント管理|職員の登録・編集・削除、権限設定（施設管理者/一般職員）|施設管理者のみ|

---

### 3.8 データ管理 (/data)

|パス|ページ名|主な機能|備考|
|---|---|---|---|
|`/data/export`|データエクスポート|記録データのCSVダウンロード、期間指定、バックアップ|施設管理者のみ|

---

## 4. 主要な業務フロー

### 4.1 朝の業務フロー

```
1. /dashboard でアクセス
2. /attendance/schedule で本日の出席予定を確認・調整
   - 欠席連絡があった子を「欠席」に変更
   - イレギュラー出席の子を追加
3. /attendance/qr を開いてタブレットに表示
4. 子どもが登校時にQRスキャン
```

### 4.2 記録業務フロー（メイン）

```
1. /dashboard から「活動記録を書く」
2. /records/activity で今日の全体活動を入力
   - 音声入力・テンプレート活用
   - 複数職員でリアルタイム編集
3. 特定の子の様子を記録したい場合
   → /records/observation/:childId に展開
   - 活動記録と同時編集
   - タグ付けで観点分類
```

### 4.3 保護者対応フロー

```
1. /children で対象の子どもを検索
2. /children/:id で詳細確認
3. /children/:id/summary で成長の変化をグラフ確認
4. /children/:id/report でレポート生成
5. 保護者に共有（共有履歴を自動記録）
```

---

## 5. URL設計ルール

### 5.1 命名規則

- **リソース名は複数形**: `/children`, `/records`, `/settings`
- **アクションは動詞ではなくパス**: `/new`, `/:id/edit`
- **階層は3階層まで**: `/children/:id/summary`

### 5.2 パラメータ

- **`:id`**: リソースの一意識別子（例: 子どもID、会社ID）
- **`:childId`**: 子ども特定が必要な場合の明示的パラメータ

### 5.3 権限別のトップレベル

- `/admin/*`: サイト管理者専用
- その他: 施設管理者/職員（権限により制限）

---

## 6. ページ間の連携

### 6.1 クイックアクセス

各ページの共通ヘッダー・サイドバーから以下へ素早くアクセス可能:

- `/dashboard` - ホームに戻る
- `/records/activity` - 活動記録（最頻出）
- `/attendance/list` - 今日の出席確認
- `/children` - 子ども検索

### 6.2 コンテキスト連携

- **活動記録** → **子ども観察記録**: 記録中に特定の子の名前をタグ付けすると、その子の観察記録として自動分類
- **子ども詳細** → **各種記録**: 子ども詳細ページから直接その子の観察記録・声記録へ遷移可能

---

## 7. 通知・アラート機能

### 7.1 ダッシュボード表示アラート

- **未記録アラート**: 今日記録が入力されていない出席児童を表示
- **未帰所通知**: 下校時刻から30分経過しても帰所していない児童を表示

### 7.2 リアルタイム通知

- 複数職員が同じ記録を編集中の場合、リアルタイムで反映

---

## 8. 今後の拡張性

### 8.1 追加予定機能

- 保護者向けポータル（`/parent/*`）
- 外部提出資料の自動生成
- AIによるタグ自動付与

### 8.2 API設計

各ページに対応するRESTful APIエンドポイントを別途定義予定。

---

## 9. 技術要件

### 9.1 対応デバイス

- PC（Chrome, Edge, Safari最新版）
- タブレット（iPad, Android タブレット）
- スマートフォン（iOS, Android）※一部機能

### 9.2 必須機能

- **リアルタイム編集**: WebSocket または長時間ポーリング
- **音声入力**: Web Speech API または外部API連携
- **QRコード**: QRコード生成・読み取りライブラリ
- **CSVインポート/エクスポート**: ブラウザ対応

---

## 10. セキュリティ要件

### 10.1 認証

- メールアドレス・パスワード認証
- セッション管理（タイムアウト: 8時間）

### 10.2 権限制御

- ロールベースアクセス制御（RBAC）
    - サイト管理者
    - 施設管理者
    - 一般職員

### 10.3 データ保護

- 個人情報の暗号化
- アクセスログの記録
- 定期バックアップ

---

**作成日**: 2024年XX月XX日  
**最終更新**: 2024年XX月XX日  
**承認者**: XX