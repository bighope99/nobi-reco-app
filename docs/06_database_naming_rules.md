#  のびレコ データベース命名規則

## 📋 目次

1. [基本方針](https://claude.ai/chat/a124b55d-b68a-4833-a41e-f455665f97a7#1-%E5%9F%BA%E6%9C%AC%E6%96%B9%E9%87%9D)
2. [テーブル命名規則](https://claude.ai/chat/a124b55d-b68a-4833-a41e-f455665f97a7#2-%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E5%91%BD%E5%90%8D%E8%A6%8F%E5%89%87)
3. [カラム命名規則](https://claude.ai/chat/a124b55d-b68a-4833-a41e-f455665f97a7#3-%E3%82%AB%E3%83%A9%E3%83%A0%E5%91%BD%E5%90%8D%E8%A6%8F%E5%89%87)
4. [ビュー・ストアドプロシージャ](https://claude.ai/chat/a124b55d-b68a-4833-a41e-f455665f97a7#4-%E3%83%93%E3%83%A5%E3%83%BC%E3%83%BB%E3%82%B9%E3%83%88%E3%82%A2%E3%83%89%E3%83%97%E3%83%AD%E3%82%B7%E3%83%BC%E3%82%B8%E3%83%A3)
5. [英語とローマ字の使い分け](https://claude.ai/chat/a124b55d-b68a-4833-a41e-f455665f97a7#5-%E8%8B%B1%E8%AA%9E%E3%81%A8%E3%83%AD%E3%83%BC%E3%83%9E%E5%AD%97%E3%81%AE%E4%BD%BF%E3%81%84%E5%88%86%E3%81%91)
6. [命名規則クイックリファレンス](https://claude.ai/chat/a124b55d-b68a-4833-a41e-f455665f97a7#6-%E5%91%BD%E5%90%8D%E8%A6%8F%E5%89%87%E3%82%AF%E3%82%A4%E3%83%83%E3%82%AF%E3%83%AA%E3%83%95%E3%82%A1%E3%83%AC%E3%83%B3%E3%82%B9)

---

## 1. 基本方針

### 1.1 すべてのテーブルに接頭辞を付与

- **目的**: テーブルの役割を一目で判別できるようにする
- **メリット**:
    - SQLエディタでの補完がしやすい（`m_` と入力すればマスタ一覧が表示）
    - 保守性の向上（テーブルの種類がすぐわかる）

### 1.2 命名の基本ルール

- **英語表記を優先**（わかりにくい場合のみローマ字）
- **スネークケース**を使用（例: `attendance_schedule`）
- **複数形と単数形の使い分け**を明確にする

---

## 2. テーブル命名規則

### 2.1 接頭辞の一覧

| 接頭辞    | 分類     | 説明                     | 更新頻度    |
| ------ | ------ | ---------------------- | ------- |
| `m_`   | マスタ    | 会社、施設、職員、子どもなど基本エンティティ | 低       |
| `r_`   | 記録     | 日々の業務記録                | 高       |
| `s_`   | 設定     | 施設設定、スケジュールパターンなど      | 中       |
| `h_`   | 履歴・ログ  | システムログ、監査用データ          | 高（追記のみ） |
| `_`    | 中間テーブル | 多対多リレーションの紐付け          | 中       |
| `tmp_` | 一時テーブル | 処理中の作業用データ             | -       |

---

### 2.2 マスタテーブル（`m_`）

#### 定義

- 業務の基本エンティティ
- 他のテーブルから外部キーで参照される
- 削除されることは稀

#### 命名ルール

```
m_{エンティティ名（複数形）}
```

#### 具体例

```
m_companies          会社
m_facilities         施設
m_classes            クラス
m_users              職員（ログインユーザー）
m_children           子ども
m_observation_tags   観点タグ（自立、社会性など）
```

#### 判断基準

- ✅ 「これは基本情報か？」
- ✅ 「削除されることは稀か？」
- ✅ 「他のテーブルから参照されるか？」

---

### 2.3 記録テーブル（`r_`）

#### 定義

- 日々の業務で作成される記録
- 時系列データ
- 頻繁に追加される

#### 命名ルール

```
r_{記録の種類（単数形）}
```

#### 具体例

```
r_activity           活動記録（全体）
r_observation        子ども観察記録（個別）
r_voice              子どもの声記録
r_report             生成されたレポート
```

#### 単数形を使う理由

- `r_` で「記録の集まり」を表現しているため
- `r_activity` であって `r_activities` ではない

#### 判断基準

- ✅ 「日付と紐づくか？」
- ✅ 「日々追加されるか？」
- ✅ 「業務上必要な記録か？」

---

### 2.4 設定テーブル（`s_`）

#### 定義

- 施設ごとの設定・パターン定義
- システムの動作を制御するデータ
- マスタほど固定的ではないが、記録ほど頻繁でもない

#### 命名ルール

```
s_{設定の対象}
```

#### 具体例

```
s_attendance_schedule    子ども別曜日通所設定（月水金など）
s_template               定型文・テンプレート
s_facility_config        施設の詳細設定（将来用）
```

#### マスタ（`m_`）との違い

|種類|説明|例|
|---|---|---|
|**マスタ**|エンティティそのもの|`m_facilities` = 施設という存在|
|**設定**|エンティティの振る舞いを定義|`s_attendance_schedule` = この子は月水金に来る|

---

### 2.5 履歴・ログテーブル（`h_`）

#### 定義

- 監査・トラブルシュート用
- 削除されない（保持期間のみ設定）
- 主に参照のみ（更新・削除は基本的にしない）

#### 命名ルール

```
h_{ログの種類}
```

#### 具体例

```
h_login              ログイン履歴
h_attendance         出欠実績ログ（QRスキャン記録）
h_report_share       レポート共有履歴
h_data_export        データエクスポート履歴
```

#### 記録（`r_`）との違い

|種類|説明|例|更新可能性|
|---|---|---|---|
|**記録**|業務上必要な記録|`r_activity` = 活動記録|あり|
|**履歴**|システム的なログ|`h_login` = ログイン履歴|なし|

#### 迷いやすいケース

```
✅ h_attendance      出欠実績（変更されないログ）
✅ r_report          レポート（後で編集可能性あり）
```

---

### 2.6 中間テーブル（`_` 接頭辞のみ）

#### 定義

- 多対多リレーションの紐付け
- 2つのテーブルの組み合わせを表現

#### 命名ルール

```
_{テーブル1}_{テーブル2}
```

- テーブル1, 2 は**接頭辞を除いた部分**
- **主従関係**を考慮して順序を決める

#### 具体例

```
_user_facility       職員-施設（1職員が複数施設を担当可能）
_user_class          職員-クラス
_child_class         子ども-クラス
_record_tag          記録-タグ
```

#### 主従関係の判断

```
_user_facility    user（主）が facility（従）に所属
_record_tag       record（主）に tag（従）が付与される
```

#### 外部キーの命名

```sql
-- 接頭辞なしのテーブル名（単数形）_id
user_id              m_users への外部キー
facility_id          m_facilities への外部キー
```

---

### 2.7 一時テーブル（`tmp_`）

#### 定義

- 処理中の一時データ
- 定期的に削除される可能性がある

#### 命名ルール

```
tmp_{処理の目的}
```

#### 具体例

```
tmp_import_children      CSV一括登録の作業テーブル
tmp_report_generation    レポート生成中の一時データ
```

---

## 3. カラム命名規則

### 3.1 予約カラム（全テーブル共通）

すべてのテーブルに以下のカラムを含める：

```sql
id                UUID or BIGINT    主キー（UUID推奨）
created_at        TIMESTAMP         作成日時（タイムゾーン付き）
updated_at        TIMESTAMP         更新日時（タイムゾーン付き）
deleted_at        TIMESTAMP         削除日時（論理削除用、nullable）
```

---

### 3.2 外部キー

#### 命名ルール

```
{テーブル名（接頭辞なし、単数形）}_id
```

#### 具体例

```sql
facility_id       m_facilities への外部キー
child_id          m_children への外部キー
user_id           m_users への外部キー
company_id        m_companies への外部キー
```

#### 注意点

- `m_children` の外部キーは `child_id`
    - ❌ `children_id` ではない
    - 理由: 英語として単数形が自然

---

### 3.3 フラグ（真偽値）

#### 命名ルール

```
is_{状態}         状態を表すフラグ
has_{属性}        属性の有無を表すフラグ
```

#### 具体例

```sql
is_active             有効/無効
is_deleted            削除済みか
has_allergy           アレルギーあり
has_special_needs     特別な支援が必要
```

---

### 3.4 日時カラム

#### 命名ルール

```
{動作}_at         タイムスタンプ（時刻まで必要）
{期間}_date       日付のみ
```

#### 具体例

```sql
-- タイムスタンプ（TIMESTAMP）
enrolled_at           入所日時
withdrawn_at          退所日時
published_at          公開日時
checked_in_at         チェックイン日時

-- 日付のみ（DATE）
birth_date            生年月日
start_date            開始日
end_date              終了日
```

---

### 3.5 数値・テキスト

#### 数値

```sql
{項目}_count          数（例: record_count）
{項目}_amount         金額（例: fee_amount）
{項目}_rate           割合（例: attendance_rate）
```

#### テキスト

```sql
{項目}_name           名前（例: facility_name）
{項目}_description    説明文（例: activity_description）
{項目}_note           備考・メモ（例: health_note）
```

---

## 4. ビュー・ストアドプロシージャ

### 4.1 ビュー（`v_`）

#### 命名ルール

```
v_{ビューの内容}
```

#### 具体例

```sql
v_daily_summary           本日の記録サマリ
v_child_growth_summary    子ども成長サマリ
v_attendance_status       出席状況
v_active_children         在籍中の子ども一覧
```

---

### 4.2 ストアドプロシージャ（`sp_`）

#### 命名ルール

```
sp_{動詞}_{目的}
```

#### 具体例

```sql
sp_generate_report        レポート生成
sp_calculate_growth       成長スコア計算
sp_cleanup_old_logs       古いログ削除
sp_export_records         記録データエクスポート
```

---

## 5. 英語とローマ字の使い分け

### 5.1 基本方針

**英語を優先**

一般的な英語表現がある場合は英語を使用する。

### 5.2 英語を使う例

```
✅ attendance        出席
✅ observation       観察
✅ facility          施設
✅ schedule          予定
✅ activity          活動
✅ record            記録
✅ template          テンプレート
```

### 5.3 ローマ字を検討するケース

現場で使われる日本語の専門用語で、英訳が不自然な場合：

```
⚠️ oyatsu            おやつ（snackより現場で通じる可能性）
⚠️ renrakucho        連絡帳（contact_bookより自然な可能性）
```

### 5.4 最終判断

- 基本は**英語**
- 現場スタッフとヒアリングして決定
- 一度決めたら統一する

---

## 6. 命名規則クイックリファレンス

### 6.1 テーブル接頭辞一覧表

|接頭辞|分類|命名ルール|例|
|---|---|---|---|
|`m_`|マスタ|`m_{エンティティ（複数形）}`|`m_children`, `m_facilities`|
|`r_`|記録|`r_{記録種類（単数形）}`|`r_activity`, `r_observation`|
|`s_`|設定|`s_{設定対象}`|`s_attendance_schedule`|
|`h_`|履歴・ログ|`h_{ログ種類}`|`h_login`, `h_attendance`|
|`_`|中間テーブル|`_{テーブル1}_{テーブル2}`|`_user_facility`, `_record_tag`|
|`tmp_`|一時テーブル|`tmp_{処理目的}`|`tmp_import_children`|
|`v_`|ビュー|`v_{内容}`|`v_daily_summary`|
|`sp_`|ストアドプロシージャ|`sp_{動詞}_{目的}`|`sp_generate_report`|

---

### 6.2 主要テーブル例

#### マスタテーブル

```
m_companies              会社
m_facilities             施設
m_classes                クラス
m_users                  職員
m_children               子ども
m_observation_tags       観点タグ
```

#### 記録テーブル

```
r_activity               活動記録
r_observation            子ども観察記録
r_voice                  子どもの声記録
r_report                 レポート
```

#### 設定テーブル

```
s_attendance_schedule    曜日通所設定
s_template               定型文
```

#### 履歴テーブル

```
h_login                  ログイン履歴
h_attendance             出欠実績ログ
h_report_share           レポート共有履歴
```

#### 中間テーブル

```
_user_facility           職員-施設
_user_class              職員-クラス
_child_class             子ども-クラス
_record_tag              記録-タグ
```

---

### 6.3 カラム命名パターン

|種類|パターン|例|
|---|---|---|
|主キー|`id`|`id`|
|外部キー|`{テーブル名単数}_id`|`child_id`, `facility_id`|
|フラグ|`is_{状態}`, `has_{属性}`|`is_active`, `has_allergy`|
|タイムスタンプ|`{動作}_at`|`created_at`, `enrolled_at`|
|日付|`{期間}_date`|`birth_date`, `start_date`|
|名前|`{項目}_name`|`facility_name`|
|説明|`{項目}_description`|`activity_description`|
|備考|`{項目}_note`|`health_note`|
|数|`{項目}_count`|`record_count`|

---

### 6.4 判断フローチャート

#### テーブルの接頭辞を決める

```
質問1: これは2つのテーブルの紐付けか？
  → Yes: `_` （中間テーブル）
  → No: 質問2へ

質問2: これは一時的な作業用データか？
  → Yes: `tmp_`
  → No: 質問3へ

質問3: これは基本エンティティ（マスタ）か？
  → Yes: `m_`
  → No: 質問4へ

質問4: これは日々の業務記録か？
  → Yes: `r_`
  → No: 質問5へ

質問5: これは設定・パターン定義か？
  → Yes: `s_`
  → No: 質問6へ

質問6: これはシステムログ・監査用か？
  → Yes: `h_`
  → No: 再検討
```

---

## 7. 運用ルール

### 7.1 命名規則の変更

- 命名規則を変更する場合は、このドキュメントを更新
- 変更履歴を記録
- 既存テーブルへの影響を確認

### 7.2 新規テーブル追加時

1. このドキュメントの判断フローに従う
2. 接頭辞を決定
3. 既存テーブルとの命名の一貫性を確認
4. レビュー後に作成

### 7.3 迷った場合

- チーム内で議論
- このドキュメントに判断基準を追記
- 一度決めたら統一する

---

**作成日**: 2025年XX月XX日  
**最終更新**: 2025年XX月XX日  
**管理者**: プロジェクトリーダー