# DBテーブル不足指摘（要件突合）

## 追加が必要なテーブル案
- **h_audit_log / h_data_access_log**: 要件の「監査ログを1年間保持」に対応。閲覧・更新・削除・エクスポート・権限変更・認証失敗を含む証跡をWORM/署名で保存するための履歴テーブル。
- **h_login**: ログイン履歴。認証失敗の検知、端末/IP監査、異常行動アラートの根拠とする。
- **r_notification / h_notification_delivery**: SYS-02/03（お知らせ・通知）に対応。下書き/公開状態、閲覧既読、プッシュ/メール送信結果（成功/失敗理由、再送フラグ）を保持する。
- **r_ai_job / h_ai_trace**: REC-03（AI解析）での入力テキスト、推奨タグ、所要時間、コスト、プロンプト/モデル版を記録し、再学習・トラブルシュートに活用する。
- **r_record_approval_history**: REC-04（記録確認・承認）の履歴。誰がどのバージョンを承認/差戻ししたか、コメント、タイムスタンプを保持する。
- **r_report / h_report_share**: RPT-01（レポート出力）や今後の保護者共有を支えるレポート生成結果、配布・閲覧履歴。PDFハッシュ/保存先、公開期限、アクセス制御を含む。
- **s_message_template / s_ai_prompt_template**: テンプレート・プロンプト管理。MVP機能のテンプレート入力や将来の外部提出資料に備え、バージョン管理と公開範囲を記録する。
- **s_retention_policy**: データ保持・削除方針をテーブル化し、個人情報削除リクエストや法定保存期間の差異に対応できるようにする。

## 既存テーブルへの追記検討
- `r_activity` / `r_observation`: 承認ステータス（下書き/承認/差戻し）や改訂版の識別子を持たせると監査/レポート整合性が向上する。
- `h_attendance`: アラート通知（未帰所）との関連付けや二重打刻の監査用に、検出済み異常のフラグ・検知理由を保持するカラムを検討する。
