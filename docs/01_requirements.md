# 01_requirements.md - のびレコ要件定義書

## 📋 目次

1. [プロジェクト概要](#1-プロジェクト概要)
2. [現状の問題点とゴール](#2-現状の問題点とゴール)
3. [システムスコープ](#3-システムスコープ)
4. [ユーザーロール・権限](#4-ユーザーロール権限)
5. [機能要件](#5-機能要件)
6. [技術スタック](#6-技術スタック)
7. [非機能要件](#7-非機能要件)
8. [目標数値・KPI](#8-目標数値kpi)
9. [開発優先順位](#9-開発優先順位)
10. [今後の検討課題](#10-今後の検討課題)

---

## 1. プロジェクト概要

### 1.1 名称・目的

- **名称**: のびレコ（Nobi-Reco）
- **目的**: 子どもの「のびしろ（成長・強み）」を見える化し、保育・教育現場の記録業務を効率化するSaaSアプリケーション

### 1.2 コアバリュー（提供価値）

| バリュー | 説明 |
|----------|------|
| **記録の統合** | 日々の活動記録から個人の成長記録を自動抽出し、二度手間を解消 |
| **質の標準化** | AIサポートと共通の評価軸（非認知能力タグ）により、指導者の経験値に依存しない評価を実現 |
| **可視化** | 蓄積されたデータをグラフやレポートで可視化し、保護者連携や指導計画へ活用 |

### 1.3 主な利用シーン

- **学童保育**
- **保育園・幼稚園**
- **児童福祉施設**

---

## 2. 現状の問題点とゴール

### 2.1 現状の問題点

| 問題点 | 詳細 |
|--------|------|
| **記録がバラバラ** | 出欠、ケガ・トラブル、日々の様子、支援が必要な子のメモなどが散在 |
| **時間不足** | 個別の記録を書く時間がない |
| **感覚頼み** | 成長や変化が「なんとなく」の感覚止まり |
| **記録の偏り** | 保育日誌を書くメンバーが固定化している |
| **保護者との情報共有不足** | 親が学童や学校での子供の様子がわからない |

### 2.2 ゴール設定

| ゴール | 具体的な状態 |
|--------|-------------|
| **一元管理** | 記録を一つにまとめ、簡単管理。外部提出も容易に |
| **複数視点の記録** | 保育日誌や活動記録が複数人の視点から書ける |
| **個別記録の自動化** | 活動記録から個別記録が自動的に抽出される（AI活用） |
| **保護者共有** | 今日の活動と個別記録を保護者に共有し、家庭内コミュニケーションと育児不安を軽減 |

### 2.3 解決すべき課題

1. 外部提出用の"整った形"が自動で出てこない
2. 複数人の視点を自然に寄せ集める仕掛けがない
3. 「日誌の中のこの部分は◯◯くんの個別記録」とシステムが理解してくれる構造やルールがまだない（→ メンション機能で解決）
4. 保護者向けの「見せ方」を前提にしたデータ構造がない

---

## 3. システムスコープ

### 3.1 対象範囲（In-Scope）

#### システム構成
- **Webアプリケーション**: PC（管理画面用）およびタブレット/スマートフォン（現場入力用）対応
- **組織構造**: 1企業（テナント）が複数施設、複数クラスを管理できるマルチテナント構成

#### 主要機能
- 認証・権限管理
- マスタ管理（組織・施設・クラス・児童・職員・タグ）
- 記録機能（活動記録入力、メンション、AI解析、個別記録生成）
- ダッシュボード（成長推移の可視化）
- レポート出力（保護者向け成長記録PDF）

### 3.2 対象外・簡易実装（Out-Scope / Future）

| 項目 | MVP対応 | 備考 |
|------|---------|------|
| **保護者用マイページ/アプリ** | 実装しない | レポートは印刷またはPDF配布を想定 |
| **請求・集金・勤怠** | UI（メニューボタン）のみ | 機能は「準備中」または固定ページ表示 |
| **監査資料の自動作成** | ボタン配置のみ | 固定フォーマットのダミー出力に留める |
| **メール配信** | 実装しない | 将来的な機能として検討 |

---

## 4. ユーザーロール・権限

### 4.1 ユーザーロール一覧

| ロール | 権限レベル | 定義 | 主な操作 |
|--------|-----------|------|----------|
| **システム管理者** | Super Admin | 運営側エンジニア | 全テナントの管理、タグマスタの統廃合 |
| **組織管理者** | Org Admin | 導入企業の責任者 | 施設追加、契約管理、法人全体のダッシュボード閲覧 |
| **施設管理者** | Facility Admin | 園長・施設長 | クラス編成、職員アカウント発行、施設内全データの閲覧・編集 |
| **一般職員** | Staff | 現場の先生 | 日々の記録入力、担当クラス/グループの閲覧、レポート作成 |

### 4.2 権限別アクセス制御

#### システム管理者（Super Admin）
- **アクセス可能範囲**: 全テナント、全施設
- **主な権限**:
  - 全組織・施設の管理
  - タグマスタの統廃合
  - システム全体のログ閲覧

#### 組織管理者（Org Admin）
- **アクセス可能範囲**: 自組織配下の全施設
- **主な権限**:
  - 施設追加・削除
  - 契約管理
  - 法人全体のダッシュボード閲覧

#### 施設管理者（Facility Admin）
- **アクセス可能範囲**: 自施設のみ
- **主な権限**:
  - クラス編成・管理
  - 職員アカウント発行・権限設定
  - 施設内全データの閲覧・編集
  - データエクスポート
  - 設定管理

#### 一般職員（Staff）
- **アクセス可能範囲**: 担当クラス/グループのみ
- **主な権限**:
  - 日々の記録入力
  - 担当クラスの閲覧
  - レポート作成
- **制限事項**:
  - 設定変更不可
  - データエクスポート不可
  - 他のクラスのデータ閲覧不可

---

## 5. 機能要件

### 5.1 全体共通・認証（SYS）

| ID | 機能名 | 詳細要件 | 優先度 |
|----|--------|----------|--------|
| **SYS-01** | ログイン | メールアドレス/パスワード、Google連携によるログイン<br>ログイン後、所属する組織・施設を選択してダッシュボードへ遷移 | 高 |
| **SYS-02** | お知らせ機能 | 運営からのお知らせ、および施設内周知事項をトップ画面に表示 | 中 |
| **SYS-03** | 通知機能 | 未承認の記録がある場合、バッジやスナックバーで通知 | 中 |

**技術想定**: Firebase Auth等

---

### 5.2 管理機能（ADM）

| ID | 機能名 | 詳細要件 | 優先度 |
|----|--------|----------|--------|
| **ADM-01** | 組織・施設管理 | 組織配下に複数の施設（教室）を作成可能<br>施設ごとの住所、連絡先設定 | 高 |
| **ADM-02** | クラス管理 | 年度ごとにクラスを作成<br>担任（職員）の紐づけ | 高 |
| **ADM-03** | 職員管理 | 職員の招待、権限設定、所属施設の割り当て | 高 |
| **ADM-04** | 児童管理 | 児童情報の登録・編集・削除（論理削除）<br>CSVによる一括インポート機能<br>兄弟姉妹紐づけ（親IDでのグルーピング） | 高 |
| **ADM-05** | 年度更新 | 児童データを保持したまま、新年度のクラスへ所属を移動させる処理（進級処理） | 中 |
| **ADM-06** | タグマスタ管理 | 評価タグ（例：ポジティブ、協調性）の追加・削除<br>※システム全体で共通マスタとする（施設ごとのカスタム不可） | 高 |

**補足**:
- 年度更新は4/1切り替え対応
- タグマスタは非認知能力の評価軸を想定

---

### 5.3 記録・AI連携（REC）- コア機能

| ID | 機能名 | 詳細要件 | 優先度 |
|----|--------|----------|--------|
| **REC-01** | 活動記録入力 | 日付、クラス、活動内容（テキスト）、写真（複数枚）の登録<br>入力中の一時保存（オートセーブ）<br>音声入力・テンプレート機能 | 高 |
| **REC-02** | メンション機能 | テキストエリア内で「@」を入力時、所属クラスの児童候補をサジェスト<br>選択すると内部IDと紐づく（表示は「@名前」）<br>**同姓同名対策必須** | 高 |
| **REC-03** | AI解析・抽出 | 「AI作成」ボタン押下により実行：<br>1. メンションされた児童ごとのエピソード抽出<br>2. 「事実」と「所感」の分離<br>3. 文脈に基づく推奨タグの選択 | 高 |
| **REC-04** | 記録確認・承認 | AI生成結果（個別記録案）を一覧表示<br>人間が内容を確認・修正し、チェックボックスで承認・確定<br>確定時、活動記録と個別記録の両テーブルへ保存<br>**Human-in-the-loop** | 高 |
| **REC-05** | 個別記録手動入力 | AIを経由せず、特定の児童の個別記録を直接入力<br>子どもの声、ケガ・トラブル記録も含む | 高 |
| **REC-06** | 記録一覧・検索 | 日付、児童名、タグ、フリーワードでの検索<br>メンション漏れ（記録なし）児童のハイライト表示 | 高 |
| **REC-07** | リアルタイム編集 | 複数職員が同時に活動記録を編集可能（WebSocket等） | 高 |

**技術想定**: OpenAI GPT-4o-mini

---

### 5.4 出席管理（ATT）

| ID | 機能名 | 詳細要件 | 優先度 |
|----|--------|----------|--------|
| **ATT-01** | 本日の出席予定登録 | 曜日ベースの自動表示<br>欠席登録、イレギュラー出席登録 | 高 |
| **ATT-02** | QR出欠 | QRコード表示、子どもによる自動チェックイン | 高 |
| **ATT-03** | 出席児童一覧 | 本日出席中の子ども一覧<br>未帰所アラート表示（下校時刻から30分経過） | 高 |
| **ATT-04** | 子ども別曜日通所設定 | 各子どもの通所曜日パターンの登録・編集 | 高 |

---

### 5.5 可視化・レポート（VIZ / RPT）

| ID | 機能名 | 詳細要件 | 優先度 |
|----|--------|----------|--------|
| **VIZ-01** | 児童詳細ビュー | タイムライン形式での記録表示<br>期間指定によるタグ集計グラフ（レーダーチャートまたは棒グラフ） | 高 |
| **VIZ-02** | クラスダッシュボード | クラス全体でのタグ出現傾向<br>記録頻度の低い児童のアラート表示 | 中 |
| **VIZ-03** | 成長サマリ | 観点別の記録数推移グラフ、3ヶ月程度の変化の可視化 | 中 |
| **RPT-01** | 成長レポート出力 | 指定期間、指定テンプレートに基づき<br>写真とコメント、成長グラフを配置したPDFを生成・ダウンロード | 高 |

---

### 5.6 データ管理（DATA）

| ID | 機能名 | 詳細要件 | 優先度 |
|----|--------|----------|--------|
| **DATA-01** | データエクスポート | 記録データのCSVダウンロード、期間指定、バックアップ | 中 |
| **DATA-02** | CSV一括登録 | 子どもデータの一括インポート | 高 |

---

### 5.7 モック・プレースホルダー（MOCK）- 将来用

| ID | 機能名 | 詳細要件 | 優先度 |
|----|--------|----------|--------|
| **MOCK-01** | 監査資料 | メニュー配置。クリック時「準備中」またはサンプルPDF表示 | 低 |
| **MOCK-02** | 請求・集金 | メニュー配置。クリック時、機能紹介画像を表示 | 低 |
| **MOCK-03** | 勤怠管理 | メニュー配置。クリック時、機能紹介画像を表示 | 低 |

---

## 6. 技術スタック

| レイヤー | 技術・サービス | 選定理由 |
|----------|---------------|----------|
| **フロントエンド** | Next.js (React) | Web/スマホ両対応、高速な画面遷移、開発者人口が多い |
| **言語** | TypeScript | 型定義でバグ防止、データ構造の厳密な定義 |
| **バックエンド** | Next.js API Routes | フロントと同じ言語、開発効率が高い |
| **データベース** | PostgreSQL | 複雑な階層構造の管理、JSON型サポート |
| **インフラ/BaaS** | Supabase | PostgreSQL + 認証 + ファイル保存がセット、開発工数3-5割削減 |
| **認証** | Firebase Auth | Google連携、セキュアな認証基盤 |
| **AIモデル** | OpenAI GPT-4o-mini | 文章抽出・要約、コストと精度のバランス、日本語処理能力 |
| **リアルタイム通信** | Supabase Realtime or WebSocket | 複数職員の同時編集対応 |

---

## 7. 非機能要件

### 7.1 パフォーマンス・ユーザビリティ

| 項目 | 要件 |
|------|------|
| **レスポンス** | AI解析処理を除く画面遷移は2秒以内<br>AI処理中はローディングアニメーションを表示（処理時間の目安を表示） |
| **デバイス対応** | タブレット（iPad / Androidタブレット）での横画面操作を第一優先<br>PCは管理画面用として最適化 |
| **入力支援** | 予測変換、ソフトウェアキーボードに被らないレイアウト設計 |
| **対応ブラウザ** | Chrome, Edge, Safari最新版 |

### 7.2 セキュリティ・データ保護

| 項目 | 要件 |
|------|------|
| **通信暗号化** | 全ての通信をSSL/TLSで暗号化 |
| **データ保護** | 児童の氏名、写真などの個人情報（PII）は適切にアクセス制御 |
| **監査ログ** | 誰が・いつ・どの記録を作成/変更/削除したかのログを1年間保持 |
| **論理削除** | 児童・職員データは物理削除せず、`deleted_at`カラムで管理 |

### 7.3 可用性・拡張性

| 項目 | 要件 |
|------|------|
| **稼働時間** | 24時間365日（メンテナンス時を除く）<br>特に平日7:00-19:00の可用性を重視 |
| **スケーラビリティ** | 将来的な200施設導入、数万件の画像データ蓄積に耐えうるクラウドインフラ（AWS/GCP）選定 |
| **バックアップ** | 日次自動バックアップ、復旧テストの定期実施 |

---

## 8. 目標数値・KPI

### 8.1 事業目標

| 項目 | 目標値 | 期限 |
|------|--------|------|
| **施設導入数** | 200施設 | 5年後 |
| **事務作業削減** | 10%削減 | - |
| **記録カバー率** | 対象児童の90%以上 | 1週間あたり |
| **職員記録参加率** | 全職員が記録 | 1週間あたり |

### 8.2 SMARTゴール

| 項目 | 内容 |
|------|------|
| **Specific（具体的）** | 5年で200施設導入、事務作業10%削減 |
| **Measurable（測定可能）** | 記録カバー率90%、全職員が週1回以上記録 |
| **Achievable（達成可能）** | 段階的機能リリース、ユーザーフィードバック反映 |
| **Relevant（関連性）** | 記録業務効率化により子どもと向き合う時間増加 |
| **Time-bound（期限）** | MVP: 3ヶ月、正式リリース: 6ヶ月、200施設: 5年 |

---

## 9. 開発優先順位

### 9.1 フェーズ1: MVP（実用最小限の製品） - 3ヶ月

**目標**: 1施設でのパイロット運用開始

#### 必須機能
1. **認証**（SYS-01）
2. **組織・施設・クラス管理**（ADM-01, 02）
3. **職員・児童管理**（ADM-03, 04）
4. **活動記録入力**（REC-01）- 音声入力・テンプレート含む
5. **メンション機能**（REC-02）
6. **AI解析・抽出**（REC-03, 04）
7. **個別記録手動入力**（REC-05）
8. **本日の出席予定登録**（ATT-01）
9. **QR出欠**（ATT-02）
10. **子ども詳細ビュー**（VIZ-01）
11. **レポート出力**（RPT-01）

#### 技術検証項目
- リアルタイム編集の実装（Supabase Realtime or WebSocket）
- AI解析の精度確認（OpenAI API）
- メンション機能の同姓同名対策
- QRコード読み取りの動作確認

---

### 9.2 フェーズ2: 拡張機能 - 6ヶ月

**目標**: 5-10施設での本格運用

#### 追加機能
1. **タグマスタ管理**（ADM-06）
2. **記録一覧・検索**（REC-06）
3. **リアルタイム編集**（REC-07）
4. **出席児童一覧・未帰所アラート**（ATT-03）
5. **クラスダッシュボード**（VIZ-02）
6. **成長サマリ**（VIZ-03）
7. **データエクスポート**（DATA-01）
8. **年度更新機能**（ADM-05）

---

### 9.3 フェーズ3: スケール展開 - 1年〜

**目標**: 50施設以上の導入

#### 追加機能
1. 保護者向けポータル
2. 外部提出資料の自動生成（監査資料等）
3. AIによるタグ自動付与の精度向上
4. モバイルアプリ化（iOS/Android）
5. 多言語対応
6. 請求・集金機能（MOCK-02の本実装）
7. 勤怠管理機能（MOCK-03の本実装）

---

## 10. 今後の検討課題

### 10.1 ヒアリング項目（未確定事項）

以下の項目は現場へのヒアリングが必要：

- [ ] 保護者連絡にかかる具体的な業務負担は？
- [ ] 転記作業が発生している業務は？
- [ ] 監査資料の種類と必要な記入項目は？
- [ ] クラス分けの運用実態は？
- [ ] 薬の記録管理は必要か？
- [ ] おやつ・給食の記録詳細度は？
- [ ] 現在の記録フォーマット（紙・Excel等）の実例

### 10.2 技術的検討課題

- 写真データの保存方法（JSONB or 別テーブル or Supabase Storage）
- タグの階層構造（大分類・中分類など）
- 削除フラグ vs 物理削除の方針（論理削除で統一予定）
- AI処理のエラーハンドリング（API制限、タイムアウト等）
- メンション機能の同姓同名対策（ID紐づけ + 補足情報表示）

### 10.3 運用・保守

- データ移行の手順書
- マニュアル・FAQ作成
- サポート体制（問い合わせ対応）
- ユーザートレーニングプログラム
- 定期バックアップとリストアテスト

---

## 11. 主要業務フロー

### 11.1 朝の業務フロー
```
1. ログイン → ダッシュボード
2. 本日の出席予定を確認・調整（ATT-01）
   - 曜日ベースで自動表示
   - 欠席連絡があった子を「欠席」に変更
   - イレギュラー出席の子を追加
3. QR出欠画面をタブレットに表示（ATT-02）
4. 子どもが登校時にQRスキャン
```

### 11.2 記録業務フロー（メイン）
```
1. ダッシュボードから「活動記録を書く」
2. 活動記録入力（REC-01）
   - 音声入力・テンプレート活用
   - @メンションで児童を紐づけ（REC-02）
   - オートセーブで一時保存
3. 「AI作成」ボタンで個別記録を自動生成（REC-03）
4. AI生成結果を確認・修正・承認（REC-04）
   - Human-in-the-loop で品質担保
5. 必要に応じて手動で個別記録を追加（REC-05）
```

### 11.3 保護者対応フロー
```
1. 子ども一覧で対象の子を検索
2. 子ども詳細で基礎情報・記録を確認（VIZ-01）
3. 成長サマリで変化をグラフ確認（VIZ-03）
4. レポート生成（RPT-01）
5. PDFをダウンロードして保護者に配布
   （共有履歴を自動記録）
```

---

**作成日**: 2025年1月  
**最終更新**: 2025年1月  
**管理者**: プロジェクトリーダー